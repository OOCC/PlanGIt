Titile: 串口读写异常
Time: 2015-12-9 18:29

1. 在不使用任何其他串口工具的前提下，直接运行GR6017上位机程序，并向下位机发送数据，会存在卡顿及数据收发异常的现象；一旦使用其他串口工具操作（或只是打开）过串口后，再次运行GR6017上位机程序，软件无卡顿且串口收发正常。

	怀疑串口参数设置不一致
		（1） 打印操作前后串口参数
				对比发现，串口工具操作后的参数与操作前的参数确实存在差异
		（2） 根据串口工具操作后的参数， 在上位机程序中手动设置串口参数
				设置后，打印发现参数没有变化
		（3） 打印串口设置函数：SetCommState 返回值
				结果： 0
		（4） 百度SetCommState函数，查看返回值为0的原因
				返回0，表示SetCommState执行失败——无效参数。
				原因：	
						dcb.ByteSize = 8;
						dcb.StopBit = 1;
						以上两个设置冲突。

						当DCB用来控制8250是，对ByteSize和StopBits的设置存在以下限制：
						1、 数据位ByteSize必须为5~8
						2、 5个数据位配置两个停止位；6、7、8数据位配置1.5停止位都是不正确的设置。
						3、 dcb.StopBit: 
									0 == 一个停止位
									1 == 1.5个停止位
									2 == 两个停止位

				修改：
						dcb.StopBit = 0; /* 1个停止位 */

		（5） 总结
				1、函数返回值需要判断
				2、不合常理的事物需要花心思去深入思考
